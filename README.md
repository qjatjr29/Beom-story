# ğŸš€ Beomstory

## ğŸ¥ ì§§ì€ ì‹œì—° ì˜ìƒ (ì˜ˆì •)
> ğŸ“Œ ê¸°ëŠ¥ë³„ ì‹œì—° ì˜ìƒ 1  
> ğŸ“Œ ê¸°ëŠ¥ë³„ ì‹œì—° ì˜ìƒ 2

---

## âœ”ï¸ í”„ë¡œì íŠ¸ ê°œìš”

í‰ì†Œì˜ ì¼ìƒì´ë‚˜ ì—¬í–‰ ì¶”ì–µë“¤ì„ ê¸°ë¡í•´ ì¶”ì–µí•˜ê¸° ìœ„í•¨

### ğŸ”— ë§í¬
[ğŸš€ ì„œë¹„ìŠ¤](https://beomstory-front-6ssnvg27t-qjatjr29s-projects.vercel.app)  
[ğŸ”— í”„ë¡œì íŠ¸ ë…¸ì…˜ ë³´ê¸°](https://www.notion.so/)  
[â†–ï¸ Front ì½”ë“œ ë³´ëŸ¬ê°€ê¸° (Github)](https://github.com/qjatjr29/beomstory-front)

### âŒ›ï¸ í”„ë¡œì íŠ¸ ê¸°ê°„
`2025.02 ~ ing`

---

## ğŸ›  í”„ë¡œì íŠ¸ êµ¬ì¡°

### ì‚¬ìš© ê¸°ìˆ 
[![My Skills](https://skillicons.dev/icons?i=java,kotlin,spring,gradle,mysql,redis,kafka,docker,github,githubactions,aws&theme=light)](https://skillicons.dev)

#### ğŸŒ  ê°œë°œ ì–¸ì–´ / í”„ë ˆì„ì›Œí¬
![Java](https://img.shields.io/badge/-Java%2017-007396?style=plastic&logo=Java&logoColor=white)
![Java](https://img.shields.io/badge/-Kotlin-7F52FF?style=plastic&logo=Kotlin&logoColor=white)
![SpringBoot](https://img.shields.io/badge/-Spring%20Boot%203.4.1-6DB33F?style=plastic&logo=Spring%20Boot&logoColor=white)
![SpringCloud](https://img.shields.io/badge/-Spring%20Cloud%20-6D933F?style=plastic&logo=Spring&logoColor=white)
![JUnit5](https://img.shields.io/badge/-JUnit5-%2325A162?style=plastic&logo=JUnit5&logoColor=white)

#### ğŸ“¦ Database
![MySQL](https://img.shields.io/badge/MySQL%208-4479A1?style=plastic&logo=MySQL&logoColor=white)
![Redis](https://img.shields.io/badge/-Redis-%23DC382D?style=plastic&logo=Redis&logoColor=white)

#### ğŸ§± ì¸í”„ë¼
![Gradle](https://img.shields.io/badge/-Gradle%20-02303A?style=plastic&logo=Gradle&logoColor=white)
![AWS S3](https://img.shields.io/badge/AWS%20S3-569A31?style=plastic&logo=Amazon%20S3&logoColor=white)
![AWS S3](https://img.shields.io/badge/AWS%20EC2-FF9900?style=plastic&logo=Amazon%20EC2&logoColor=white)
![AWS S3](https://img.shields.io/badge/AWS%20ELB-8C4FFF?style=plastic&logo=Amazon%20ELB&logoColor=white)
![AWS S3](https://img.shields.io/badge/AWS%20Route53-8C4FFF?style=plastic&logo=Amazon%20Route53&logoColor=white)
![Docker](https://img.shields.io/badge/-Docker-%232496ED?style=plastic&logo=Docker&logoColor=white)
![Apache Kafka](https://img.shields.io/badge/-Apache%20Kafka-%23231F20?style=plastic&logo=ApacheKafka&logoColor=white)
![NaverCloudPlatform](https://img.shields.io/badge/-NaverCloudPlatform-03C75A?style=plastic&logo=Naver&logoColor=white)

#### ğŸ“  í˜‘ì—…íˆ´
![GitHub](https://img.shields.io/badge/-GitHub-181717?style=plastic&logo=GitHub&logoColor=white)

### ğŸ§± ERD 
<img width="600" alt="ERD" src="https://github.com/user-attachments/assets/43c29e5b-9f0d-41aa-9d1c-1d937f655a20" />

### â­ï¸ ì•„í‚¤í…ì²˜
![ì „ì²´](https://github.com/user-attachments/assets/c3a5fd23-404f-4257-b856-09ef2c35c867)

### ğŸ‘¤ ìœ ì € Flow
```mermaid
graph TD
    A[íšŒì›ê°€ì…/ë¡œê·¸ì¸] -->|ë¡œê·¸ì¸ ì„±ê³µ| B[í™ˆ í™”ë©´]
    B --> C[ì¼ìƒ ê¸°ë¡ ë³´ê¸°]
    B --> D[ì¼ìƒ ê¸°ë¡ í•˜ê¸°]
    B --> E[í”„ë¡œí•„ ë³´ê¸°]
    B --> H[ì¼ìƒ ê²€ìƒ‰]
    C --> F[ëŒ“ê¸€ ì‘ì„± - todo]
    C --> G[ê²Œì‹œë¬¼ ì¢‹ì•„ìš” - todo]
    E --> I[í”„ë¡œí•„ ìˆ˜ì •]
    D --> J[ì¼ìƒì„ ë³´ë‚¸ ì¥ì†Œ ì¶”ê°€]
    J --> N[ì‚¬ì§„ ì—…ë¡œë“œ]
    F --> K[ëŒ€ëŒ“ê¸€ ì‘ì„± - todo]
    H --> L[í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰]
    H --> M[ì¥ì†Œ ê¸°ë°˜ ê²€ìƒ‰ - todo]
    H --> O[ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ê²€ìƒ‰ - todo]
```

---

## ğŸƒí”„ë¡œì íŠ¸ ì§„í–‰

### âœ… êµ¬í˜„ í•„ìˆ˜ ê¸°ëŠ¥
- [x] íšŒì›ê°€ì… / ë¡œê·¸ì¸
- [x] êµ¬ê¸€, ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
- [x] í”„ë¡œí•„ ì¡°íšŒ / ìˆ˜ì •
- [x] ì¼ìƒ ê¸°ë¡ / ìˆ˜ì • / ì‚­ì œ
- [x] ì¼ìƒ ê¸°ë¡ ìƒì„¸ ì¡°íšŒ (ëª¨ë“  ì¥ì†Œ ì¡°íšŒ)
- [x] ì¥ì†Œ ìƒì„± / ìˆ˜ì •
- [x] ì´ë¯¸ì§€ ì—…ë¡œë“œ / ì‚­ì œ
- [x] ê¸°ë¡ ì‚­ì œì‹œ ê¸°ë¡ì— í¬í•¨ëœ ëª¨ë“  ì¥ì†Œì‚­ì œ(ì´ë¯¸ì§€ í¬í•¨)
- [x] í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰

--- 


## ğŸ§‘ğŸ»â€ğŸ’» ì‚¬ìš© ê¸°ìˆ  ë° ê³ ë ¤í•œ ë‚´ìš©

### â­ï¸ Kotlin

**âœ… ì‚¬ìš© ì´ìœ **

Javaì™€ Spring Bootë¡œ ê°œë°œì„ í•´ì™”ì§€ë§Œ ê°œì¸ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ìƒˆë¡œìš´ ì–¸ì–´ì¸ Kotlinì„ ê²½í—˜í•´ë³´ê³  ì‹¶ì—ˆìŒ.

Kotlinì€ ê°€ë…ì„±ê³¼ ë„ ì²˜ë¦¬ ë°©ì‹(Null Safety)ì´ ë›°ì–´ë‚˜ê³  ê°œë°œ ìƒì‚°ì„±ì„ ë†’ì—¬ì¤„ ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í•˜ì—¬ ë„ì…í•˜ê²Œ ë¨.

**ğŸ‘ğŸ» ì¥ì **

**Null Safety**
- Kotlinì˜ íƒ€ì… ì‹œìŠ¤í…œì„ í†µí•´ NPE(NullPointerException) ê°€ëŠ¥ì„±ì„ ì»´íŒŒì¼ íƒ€ì„ì— ì˜ˆë°©.
- ëª…ì‹œì ì¸ ?, ?:, !! ì—°ì‚°ì ì‚¬ìš©ìœ¼ë¡œ ì½”ë“œ ì•ˆì •ì„±ì„ ë†’ì„.

**í™•ì¥ í•¨ìˆ˜**
- ê¸°ì¡´ í´ë˜ìŠ¤ì— ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” Kotlin í™•ì¥ í•¨ìˆ˜ë¥¼ ì ê·¹ í™œìš©í•˜ì—¬ ì½”ë“œ ì¬ì‚¬ìš©ì„±ê³¼ ê°€ë…ì„±ì„ ë†’ì„.

**Data Class**
- ê°„ê²°í•˜ê²Œ DTO, Entity ì •ì˜ë¥¼ ìœ„í•´ data classë¥¼ ì ê·¹ í™œìš©
- equals/hashCode/toString ìë™ ìƒì„±ì˜ ì´ì ì„ í™œìš©.

---

### ğŸ“¦ Spring data R2dbc
**âœ… ì‚¬ìš© ì´ìœ **  
Kotlin + Coroutine í™˜ê²½ì—ì„œ ë¹„ë™ê¸° DB í†µì‹ ì´ í•„ìš”í•´ R2DBCë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.
Hibernate Reactiveë„ ê²€í† í–ˆìœ¼ë‚˜ ì½”ë£¨í‹´ê³¼ì˜ í˜¸í™˜ì„± ì¸¡ë©´ì—ì„œ R2DBCê°€ ë” ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

**ğŸ‘ğŸ» ì¥ì **  
- Kotlin Coroutine ì§€ì›: suspend í•¨ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë¹„ë™ê¸° ì½”ë“œ ì‘ì„± ê°€ëŠ¥
- Spring ê³µì‹ ì§€ì›: íŠ¸ëœì­ì…˜ ë“± Spring ìƒíƒœê³„ì™€ ì—°ë™ì´ ì‰¬ì›€

**âš ï¸ í•œê³„**  
- ORM ê¸°ëŠ¥ ë¯¸ì§€ì›: JPA ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© ë¶ˆê°€, ì—”í‹°í‹° ë§¤í•‘ ìˆ˜ë™ ì²˜ë¦¬ í•„ìš”  
- ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± ì—†ìŒ: ì§ì ‘ SQL ìŠ¤í¬ë¦½íŠ¸ë‚˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬ ì‚¬ìš©

ğŸ“ ì˜ˆì‹œ
```kotlin
interface UserRepository : CoroutineCrudRepository<User, Long>
suspend fun findUserById(id: Long): User? = userRepository.findById(id)
```

> [blog ì •ë¦¬](https://beomsic.tistory.com/entry/Spring-data-R2DBC)

---

### ğŸ—³ï¸ íŠ¸ëœì­ì…˜ ì•„ì›ƒë°•ìŠ¤ íŒ¨í„´ + kafka

**âœ… ì‚¬ìš© ì´ìœ **  
- ë°ì´í„° ì •í•©ì„± ë³´ì¥: ì¼ìƒ(story) ì‚­ì œ ì‹œ ì—°ê²°ëœ ì¥ì†Œ(place) ì‚­ì œë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ì„œë„ íŠ¸ëœì­ì…˜ ì•ˆì •ì„± í™•ë³´

- ì‹ ë¢°ì„±: DB íŠ¸ëœì­ì…˜ê³¼ Kafka ë©”ì‹œì§€ ë°œí–‰ì„ ì›ìì (atomic) ìœ¼ë¡œ ì²˜ë¦¬í•´ ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€

- ì‹œìŠ¤í…œ ë¶„ë¦¬: ì¥ì†Œ ì‚­ì œ ì²˜ë¦¬ë¥¼ ì´ë²¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ë¶„ë¦¬í•´ ì„œë¹„ìŠ¤ ê°„ ê²°í•©ë„ ê°ì†Œ

**ğŸ› ï¸ êµ¬í˜„ ë°©ë²•**  
1. ì´ë²¤íŠ¸ ì €ì¥ (story service)

```kotlin
@Transactional
suspend fun delete(userId: Long, storyId: Long) {
    storyDeletePort.deleteStory(userId, storyId)  // 1. ì¼ìƒ ì‚­ì œ
    storyOutboxPort.saveStoryDeleteMessage(storyId) // 2. ì•„ì›ƒë°•ìŠ¤ í…Œì´ë¸” ì €ì¥
}
```

2. message ë°œí–‰

```kotlin
@Scheduled(cron = "0 */10 * * * *")  // 10ë¶„ ì£¼ê¸° ì‹¤í–‰
@Transactional
suspend fun publishPendingMessages() {
val pendingMessages = outboxRepository.findAllByOrderByCreatedAtAsc(batchSize)

    runBlocking {
        val successfulIds = publishPendingMessagesAsync(pendingMessages) // 3. Kafka ë°œí–‰
        outboxRepository.deleteAllById(successfulIds)  // 4. ì„±ê³µí•œ ë©”ì‹œì§€ ì‚­ì œ
    }
}
```
3. consume í›„ ì‚­ì œ ì²˜ë¦¬(place service)
```kotlin
@KafkaListener(topics = ["\${kafka.topic.story-outbox}"])
fun handleStoryOutboxEvent(payload: String) {
    runBlocking {
        try {
            val storyOutboxPayload = Json.decodeFromString<StoryOutboxPayload>(payload)
            when (storyOutboxPayload.type) {
                StoryOutboxType.STORY_DELETED -> handleStoryDeletedEvent(storyOutboxPayload.storyId)
            }
        } catch (e: Exception) {
            logger.error("â— Kafka ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${e.message}")
            throw e
        }
    }
}
```
---

### ğŸ—‚ï¸ MySQL Full-Text Search

**ğŸ” ë°°ê²½ ë° ë¬¸ì œ ìƒí™©**  
ë‹¨ìˆœíˆ ì‚¬ìš©ìë“¤ì´ "ì œëª©" ë˜ëŠ” "ì„¤ëª…"ì— í¬í•¨ëœ í‚¤ì›Œë“œë¡œ `LIKE '%keyword%'` ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ë„ë¡ ì„¤ê³„í–ˆì§€ë§Œ ì´ëŠ” í…Œì´ë¸” í’€ ìŠ¤ìº” ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šì„ ê²ƒì´ë¼ ìƒê°

**ğŸ› ï¸ í•´ê²°ì±…: Full-Text Search + n-gram**

```sql
ALTER TABLE table_A ADD FULLTEXT INDEX idx_fulltext_title_desc (title, description);
```

```sql
EXPLAIN 
SELECT * FROM table_A WHERE MATCH(title, description) AGAINST('ì—¬í–‰' IN BOOLEAN MODE);
```


> [blog ì •ë¦¬](https://beomsic.tistory.com/entry/MySQL-Full-Text-Search-%EB%8F%84%EC%9E%85%EA%B8%B0)

---

## ğŸ’¥ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### ğŸ“¨ ì½”ë£¨í‹´ ê¸°ë°˜ì˜ ë¹„ë™ê¸° ë©”ì‹œì§€ ì „ì†¡ ë°©ì‹
```
íŠ¸ëœì­ì…˜ ì•„ì›ƒë°•ìŠ¤ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ outbox í…Œì´ë¸”ì—ì„œ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ Kafkaë¡œ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ì—¬ ë°ì´í„°ì˜ ì •í•©ì„±ì„ ë§ì¶”ëŠ” ê³¼ì •ì—ì„œ
ë©”ì‹œì§€ê°€ ì‹¤ì œë¡œ Kafkaì— ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ë¥¼ íŒŒì•…í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.
```

ì´ˆê¸°ì—ëŠ” _KafkaTemplate.send().get()_  ë¥¼ í†µí•´ ë™ê¸°ì ìœ¼ë¡œ ë©”ì‹œì§€ê°€ ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

> ğŸ’£ë¬¸ì œì 
- ë™ê¸°ì  ì²˜ë¦¬ë¡œ ë©”ì‹œì§€ë‹¹ ì‘ë‹µì„ ê¸°ë‹¤ë ¤ì•¼ í•¨
- ëŒ€ëŸ‰ ë©”ì‹œì§€ ì²˜ë¦¬ ì‹œ ì„±ëŠ¥ ì €í•˜
- Kafkaì˜ ë¹„ë™ê¸°ì  íŠ¹ì„±ì„ í™œìš©í•˜ì§€ ëª»í•¨
- ìˆœì°¨ì  ì²˜ë¦¬ë¡œ ì „ì²´ ì†Œìš” ì‹œê°„ ì¦ê°€

> **ì½”ë£¨í‹´ ê¸°ë°˜ì˜ ë¹„ë™ê¸° ë©”ì‹œì§€ ì „ì†¡ ë°©ì‹** ìœ¼ë¡œ í•´ê²°  
> [í•´ê²° ê³¼ì • - blog](https://beomsic.tistory.com/entry/%F0%9F%9A%90-Kafka-%EB%A9%94%EC%8B%9C%EC%A7%80-%EB%B0%9C%ED%96%89-%EC%B5%9C%EC%A0%81%ED%99%94-%EB%8F%99%EA%B8%B0-%EB%B0%A9%EC%8B%9D%EC%97%90%EC%84%9C-%EC%BD%94%EB%A3%A8%ED%8B%B4%EA%B9%8C%EC%A7%80%EC%9D%98-%EC%97%AC%EC%A0%95)

---

### ğŸ“‚ Spring Data R2DBC - Coroutine ê³¼ Pagination

**ğŸ” ë¬¸ì œ ìƒí™©**  
Spring Data R2DBCëŠ” ë¦¬ì•¡í‹°ë¸Œ íŠ¹ì„±ìƒ Page/Slice ë°˜í™˜ì„ ê³µì‹ ì§€ì› âŒ
ê¸°ì¡´ JPAì˜ PagingAndSortingRepositoryì²˜ëŸ¼ ìë™í™”ëœ í˜ì´ì§•ì´ ë¶ˆê°€ëŠ¥í•´ ì¡°íšŒ + ì´ ê°œìˆ˜ ì¿¼ë¦¬ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ê²°í•©
**ğŸ› ï¸ í•´ê²° ì „ëµ** 

ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬ êµ¬í˜„
- DatabaseClientë¥¼ ì´ìš©í•´ LIMIT/OFFSET ê¸°ë°˜ SQL ì§ì ‘ ì‘ì„±

```kotlin
(ì˜ˆì‹œ)
val contentSql = """
    SELECT * FROM story
    WHERE title = :title
    LIMIT :limit OFFSET :offset
"""
val countSql = "SELECT COUNT(*) FROM story WHERE title = :title"
```

ë³‘ë ¬ ì¿¼ë¦¬ ì‹¤í–‰
- ì»¨í…ì¸  ì¡°íšŒì™€ ì´ ê°œìˆ˜ ì¡°íšŒë¥¼ ì½”ë£¨í‹´ ë³‘ë ¬ ì²˜ë¦¬
```kotlin
suspend fun paginate(...): Page<StoryEntity> {
    val content = contentQuery()
    val total = countQuery()
    return PageImpl(content, pageable, total)
}
```

**âš ï¸ ì£¼ì˜ì‚¬í•­**  
- SQL ì¤‘ë³µ: ì»¨í…ì¸ /ê°œìˆ˜ ì¿¼ë¦¬ì˜ ì¡°ê±´ë¬¸ì´ ë™ê¸°í™”ë˜ì§€ ì•Šìœ¼ë©´ ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œìƒ
- ì„±ëŠ¥ ì €í•˜: OFFSET ê°’ì´ í´ìˆ˜ë¡ ì¿¼ë¦¬ ì„±ëŠ¥ì´ ì„ í˜•ì ìœ¼ë¡œ ê°ì†Œ
- íŠ¸ëœì­ì…˜ ë¶„ë¦¬: ê°œìˆ˜ ì¿¼ë¦¬ì™€ ì»¨í…ì¸  ì¿¼ë¦¬ê°€ ë‹¤ë¥¸ ìŠ¤ëƒ…ìƒ·ì„ ë³¼ ìˆ˜ ìˆìŒ


**ğŸš€ ìµœì í™” ë°©ì•ˆ(todo)**
1. ì»¤ì„œ ê¸°ë°˜ í˜ì´ì§• (ê³ ë ¤)

```sql
WHERE id > :lastId ORDER BY id LIMIT :size
```
- OFFSET ëŒ€ì‹  ID ë²”ìœ„ ì¡°ê±´ ì‚¬ìš©


2. R2dbcEntityTemplate í™œìš©

```kotlin
template.select(StoryEntity::class)
    .matching(Query.query(where("title").`is`(title)).with(pageable))
    .all()
```

3. ìºì‹œ ì „ëµ

```kotlin
@Cacheable("storyCount")
suspend fun getTotalCount(): Long
```
- ê°œìˆ˜ ì •ë³´ì— ëŒ€í•´ ìºì‹±ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ í–¥ìƒë  ê²ƒì´ë¼ ì˜ˆìƒ






